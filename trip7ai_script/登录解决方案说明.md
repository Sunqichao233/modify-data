# Playwright 登录问题解决方案

当脚本无法自动登录时，我们提供了多种解决方案来处理登录问题。

## 方案一：手动登录模式（推荐）

### 配置方法
在 `playwright_config.json` 中设置：
```json
"loginConfig": {
    "enabled": true,
    "manualLogin": true,
    "useCookies": true
}
```

### 工作流程
1. 脚本会打开浏览器并导航到登录页面
2. 浏览器会保持打开状态，等待您手动登录
3. 您可以在浏览器中正常操作：输入用户名、密码、处理验证码等
4. 登录成功后，脚本会自动检测并继续执行
5. 登录信息会被保存为Cookie，下次运行时自动使用

### 优点
- 可以处理任何复杂的登录流程（验证码、双因素认证等）
- 一次手动登录，后续自动使用Cookie
- 最稳定可靠的方案

## 方案二：Cookie会话保持

### 配置方法
在 `playwright_config.json` 中设置：
```json
"loginConfig": {
    "enabled": true,
    "useCookies": true
}
```

### 工作流程
1. 首次运行时正常登录（自动或手动）
2. 登录成功后，Cookie会自动保存到 `cookies.json` 文件
3. 后续运行时，脚本会先尝试使用保存的Cookie登录
4. 如果Cookie有效，跳过登录步骤直接进入主流程
5. 如果Cookie失效，回退到正常登录流程

### 优点
- 大大减少登录次数
- 提高脚本运行效率
- 适合长期使用

## 方案三：跳过登录直接访问

### 适用场景
- 网站不需要登录就能访问目标页面
- 您已经在浏览器中保持登录状态

### 配置方法
在 `playwright_config.json` 中设置：
```json
"loginConfig": {
    "enabled": false
}
```

然后将 `websiteUrl` 直接设置为目标页面：
```json
"websiteUrl": "https://www.trip7.ai/admin/watchHistory/manage"
```

## 方案四：浏览器用户数据目录

### 配置方法
修改 `playwright_downloader.js` 中的浏览器启动参数：
```javascript
const browser = await playwright[this.config.browserType].launch({
    headless: this.config.headless,
    userDataDir: './browser-data' // 添加这行
});
```

### 优点
- 保持浏览器的所有登录状态
- 包括扩展程序、书签等
- 最接近真实用户行为

## 推荐使用顺序

1. **首选：手动登录模式 + Cookie保存**
   - 设置 `"manualLogin": true` 和 `"useCookies": true`
   - 首次手动登录，后续自动使用Cookie

2. **备选：纯Cookie模式**
   - 设置 `"useCookies": true`
   - 让脚本尝试自动登录并保存Cookie

3. **最后：跳过登录**
   - 设置 `"enabled": false`
   - 直接访问目标页面

## 故障排除

### 如果手动登录模式不工作
1. 检查 `loggedInIndicator` 选择器是否正确
2. 确保登录成功后页面有明显的元素变化
3. 检查控制台输出的错误信息

### 如果Cookie保存不工作
1. 检查下载目录的权限
2. 确保 `cookies.json` 文件可以被创建和读取
3. 检查Cookie是否包含必要的登录信息

### 如果自动登录失败
1. 检查用户名和密码是否正确
2. 验证登录页面的元素选择器
3. 查看是否有验证码或其他安全措施
4. 考虑切换到手动登录模式

## 运行命令

无论使用哪种方案，运行命令都是：
```bash
node quick_start_playwright.js
```

脚本会根据配置自动选择合适的登录方式。